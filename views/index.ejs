<% include partials/header %>

<div class="container">

	<h1>Address Book</h1>


	<h2>Groups</h2>
	<a href="/group/new">Add new Group</a>
	<div class="groups">
		<% groups.forEach(group => { %>
			<p class="group" style="background-color:<%=group.colour%>;color:<%=group.fontColour%>"><%=group.name%> <a class="group__icon" href="/group/<%=group._id%>/edit"><i class="fa fa-pen"></i></a></p>
		<% }) %>
	</div>

	<h2>Filters</h2>

	<form action="/" method="POST">
		<h3>Columns</h3>
		<p>Choose which columns to display below</p>
		<% for (key in categories) { %>

			<label for="<%=key%>">
				<% if(typeof columns != "undefined" && columns.includes(key)) { %> 
					<input type="checkbox" name="columns[]" value="<%=key%>" checked>
				<% } else { %>
					<input type="checkbox" name="columns[]" value="<%=key%>" >
				<% } %>
				<%=categories[key]%>
			</label>

		<% } %>
		
		<h3>Filter Groups</h3>
		<p>Choose which groups to see</p>

		<% groups.forEach(group => { %>
			<label>
				<input type="checkbox" value="<%=group._id%>" name="groups[]">
				<%=group.name%>
			</label>
		<% }) %>

		<label for="">
			<input type="radio" name="GroupFilterType" value="all" checked>
			Contains All
		</label>
		<label for="">
			<input type="radio" name="GroupFilterType" value="some">
			Contains Some
		</label>

		<button class="btn btn-primary">Submit</button>
	</form>
	

	<h2>People</h2>
	<a href="/people/new">Add new Person</a>
	<table class="table">
		<thead>
			<tr>
				<th>Name</th>

				<% if(typeof columns != "undefined") { %>
					<% columns.forEach(key => { %>
						<th><%= categories[key] %></th>
					<% }); %>
				<% } %>
	
				<th>Options</th>
			</tr>
		</thead>
		<tbody>
			<% people.forEach(person => { %>
				<tr>
					<td><%= person.firstName %> <%= person.lastName%></td>

					<% if (typeof columns != "undefined") { %> 
						<% columns.forEach(key => { %>
							<% if(key == "groups"){ %>
								<td>
									<% person.groups.forEach(group => { %>
										<span class="badge" style="background-color:<%=group.colour%>;color:<%=group.fontColour%>"><%=group.name%></span>
									<% }) %>
								</td>
							<% } else { %>
								<td><%=person[key] %></td>
							<% } %>

						<% }); %>
					<% } %>

					<td>
						<a href="/people/<%= person._id%>">Show</a>
						<a href="/people/<%= person._id %>/edit">Edit</a>
						<form action="/people/<%=person._id%>?_method=DELETE" method="POST">
							<button class="btn btn-link">Delete</button>
						</form>
					</td>
				</tr>
			<% }) %>
		</tbody>
	</table>

</div>


<% include partials/footer %>